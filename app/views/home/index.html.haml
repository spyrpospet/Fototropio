= content_for :stylesheets do
  = stylesheet_link_tag "home", "data-turbo-track": "reload"

= content_for :body do
  = turbo_frame_tag "home-slider", src: slider_url
  %div{class: "mx-auto w-11/12 mt-10 xl:p-0 xl:w-9/12 2xl:w-7/12"}
    %div{class: "flex flex-col md:flex-row md:gap-10"}
      %div{class: "md:w-2/3"}
        - @posts.each do |post|
          %div{class: "bg-white rounded overflow-hidden mb-10"}
            = link_to map_url(post.slug), class: "relative" do
              - if post.image.attached?
                = image_tag post.image.variant(:home), class: "aspect-video object-cover", alt: post.title
              - else
                %img{class: "aspect-video object-cover", src: "https://placehold.co/700x400", alt: post.title}
            %div{class: "py-6"}
              = link_to map_url(post.slug) do
                %h1{class: "text-4xl font-extrabold tracking-tight text-gray-900"}= post.title
              %div{class: "mt-5 flex items-center text-sm text-gray-500 gap-4 flex-wrap"}
                %div{class: "flex items-center gap-3"}
                  - if @user&.image&.attached?
                    = image_tag @user&.image, class: "w-8 h-8 rounded-full object-cover", alt: @user&.full_name
                  - else
                    %img{class: "w-8 h-8 rounded-full object-cover", src: "https://placehold.co/241x52", alt: "Author avatar"}
                  = link_to @user&.full_name, map_url("about-page")
                %span •
                %span= l(post.created_at, format: :long)
                %span •
                - if post.categories.any?
                  %a{href: map_url(post.main_category.slug), class: "text-orange-500 hover:underline"}= post.main_category.title
                - else
                  %a{href: "#", class: "text-orange-500 hover:underline"} Uncategorized
              %div{class: "mt-6 text-gray-600 leading-7"}
                = Sanitize.fragment(CGI.unescapeHTML(truncate(post.description.to_s, length: 400)))
        - if @pagy&.pages.to_i > 1
          %div{class: "pagination mt-8 flex justify-center"}= pagy_nav(@pagy).html_safe
      %div{class: "md:w-1/3"}
        %div{class: "space-y-10"}
          %div{class: "border-b pb-6"}
            %h3{class: "uppercase tracking-widest text-xs text-gray-400 mb-4"} Σχετικά με εμένα
            %div{class: "flex flex-col items-start"}
              - if @user&.image&.attached?
                = image_tag @user.image, class: "w-24 h-24 rounded-full object-cover mb-4", alt: "About avatar"
              - else
                %img{class: "w-24 h-24 rounded-full object-cover mb-4", src: "https://placehold.co/241x52", alt: "About avatar"}
              - if @user&.description.present?
                %p{class: "text-gray-600 leading-7"}
                  = Sanitize.fragment(CGI.unescapeHTML(truncate(@user&.description.to_s, length: 400)))
              %a{href: map_url("about-page"), class: "mt-4 inline-flex items-center text-orange-500 font-medium hover:underline"}
                περισσότερα για εμένα
                %span{class: "ml-2"} →
          - if @popular_posts.present?
            %div{class: "border-b mt-6"}
              %h3{class: "font-bold uppercase text-black mb-4"} Δημοφιλείς Δημοσιεύσεις
              - @popular_posts.each do |post|
                %div{class: "flex items-start gap-4 mb-4"}
                  = link_to map_url(post.slug) do
                    - if post.image&.attached?
                      = image_tag post.image.variant(resize_to_fill: [48, 48]), class: "w-12 h-12 rounded-full object-cover", alt: post.title
                    - else
                      %img{class: "w-12 h-12 rounded-full object-cover", src: "https://placehold.co/48x48", alt: post.title}
                  %div{class: "flex-1"}
                    %a{href: map_url(post.slug), class: "block font-semibold leading-snug hover:underline"}= truncate(post.title.to_s, length: 60)
                    %div{class: "text-xs text-gray-500 uppercase tracking-wider mt-1"}
                      = @user&.full_name
                      %span{class: "mx-1"} •
                      %span= l(post.created_at, format: :long)
          - if @categories.present?
            %div{class: "border-b pb-6"}
              %h3{class: "font-bold uppercase text-black mb-4"} Κατηγορίες
              - @categories.each do |category|
                %a{href: map_url(category.slug), class: "relative block rounded overflow-hidden mb-3 group"}
                  - if category.image&.attached?
                    - bg_url = url_for(category.image.variant(:home))
                  - else
                    - bg_url = "https://placehold.co/350x40"
                  %div{class: "relative h-16 md:h-10 w-full"}
                    %div{class: "absolute inset-0 bg-center bg-cover", style: "background-image: url('#{bg_url}');"}
                    %div{class: "absolute inset-0 bg-black/60 group-hover:bg-black/50 transition-colors"}
                    %div{class: "relative z-10 flex items-center justify-between h-full px-4 text-white font-semibold"}
                      %span= category.title
                      %span= category.published_posts.count
          - if @recent_posts.present?
            %div{class: "border-b pb-6"}
              %h3{class: "font-bold uppercase text-black mb-4"} Πρόσφατες Δημοσιεύσεις
              - @recent_posts.each do |post|
                %div{class: "mb-8"}
                  %a{href: map_url(post.slug), class: "relative block overflow-hidden rounded"}
                    - if post.image&.attached?
                      = image_tag post.image.variant(:home), class: "w-full aspect-video object-cover"
                    - else
                      %img{class: "w-full aspect-video object-cover", src: "https://placehold.co/700x400", alt: post.title}
                  %a{href: map_url(post.slug), class: "block mt-4 text-xl font-extrabold leading-snug hover:underline"}= post.title
                  %div{class: "mt-2 text-xs text-gray-500 uppercase tracking-wider flex items-center gap-3 flex-wrap"}
                    %span= @user&.full_name
                    %span •
                    %span= l(post.created_at, format: :long)
